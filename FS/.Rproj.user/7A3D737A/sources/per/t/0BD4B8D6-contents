# LCFS data

# load package
library(tidyverse)

# read data
lcfs <- read_tsv("../data/lcfs_2013_reduced.tab")

# create factor variables
# create factor variables
lcfs <- lcfs %>% 
  mutate(maininc = factor(maininc, 
                          levels = c(0,1), 
                          labels = c("earnings", 
                                     "other source") ), 
         internet = factor(A172, 
                           levels = c(1,2), 
                           labels = c("Yes", "No") ), 
         econ_pos = factor(A093r, 
                           levels = c(1,2,3,4), 
                           labels = c("Full-time working", 
                                      "Part-time working", 
                                      "Unemployed / govt training", 
                                      "Economically inactive") ), 
         ns_sec = factor(A094r, 
                         levels = c(1,2,3,4,5), 
                         labels = c("Higher managerial",
                                    "Intermediate occs", 
                                    "Routine / manual", 
                                    "LT unempl / FT student", 
                                    "Not classified") ), 
         sex_hrp_f = factor(SexHRP, 
                            levels = c(1,2), 
                            labels = c("Male", "Female") ), 
         hhsize_f = factor(hhsize), 
         region = factor(Gorx, 
                         levels = c(1:12), 
                         labels = c("North East", 
                                    "North West", 
                                    "Yorks & Humber",
                                    "East Midlands",
                                    "West Midlands",
                                    "Eastern", 
                                    "London",
                                    "South East",
                                    "South West",
                                    "Wales", 
                                    "Scotland",
                                    "Northern Ireland") ) )

# create factor variable for housing tenure
lcfs <- lcfs %>% 
  mutate(tenure = factor(A121r, 
                         levels = c(1,2,3), 
                         labels = c("Public rented", 
                                    "Private rented", 
                                    "Owned") ) )

# table of economic position
lcfs %>% 
  select(econ_pos) %>% 
  table()

# visualisation (1)
plot(lcfs$econ_pos)

# economic position by sex  
ggplot(lcfs) +
  aes(x = econ_pos) + 
  geom_bar() +
  coord_flip() +
  facet_wrap(~sex_hrp_f) +
  labs(title = "Economic position by sex", 
       x = "Economic position", 
       y = "count", 
       caption = "Source: Living Costs and Food Survey 2013")

# housing tenure by sex
ggplot(lcfs) +
  aes(x = tenure) + 
  geom_bar() +
  coord_flip() +
  facet_wrap(~sex_hrp_f) +
  labs(title = "Housing tenure by sex of HRP", 
       x = "Housing tenure", 
       y = "count", 
       caption = "Source: Living Costs and Food Survey 2013")

# quick histogram
hist(lcfs$income)

# histogram with ggplot
ggplot(lcfs) + 
  aes(x = income, y = stat(density) ) +
  geom_histogram(binwidth = 20) + 
  facet_wrap(~tenure)

# Modify this code to investigate the distribution of household expenditure 
# expenditure by total number of people living in the household  hhsize_f.
ggplot(lcfs) + 
  aes(x = expenditure, y = stat(density) ) +
  geom_histogram(binwidth = 20) + 
  facet_wrap(~hhsize_f)

# quick boxplot
boxplot(lcfs$income)

# boxplot in ggplot
ggplot(lcfs) + 
  aes(y = income) +
  geom_boxplot() +
  facet_wrap(~tenure) +
  theme(axis.ticks.x = element_blank(), 
        axis.text.x = element_blank() ) +
  labs(title = "Income by housing tenure", 
       y = "Weekly income in pounds", 
       caption = "Source: Living Costs and Food Survey 2013")

# Modify this code to investigate the distribution of household expenditure  
# expenditure by total number of people living in the household  hhsize_f.
ggplot(lcfs) + 
  aes(y = expenditure) +
  geom_boxplot() +
  facet_wrap(~hhsize_f) +
  theme(axis.ticks.x = element_blank(), 
        axis.text.x = element_blank() ) +
  labs(title = "Expenditure by household size", 
       y = "Weekly expenditure in pounds", 
       caption = "Source: Living Costs and Food Survey 2013")

# correlation coefficient
cor(lcfs$income, lcfs$expenditure)

# scatterplot in ggplot
ggplot(lcfs) +
  aes(x = income, y = expenditure) + 
  geom_point() +
  labs(title = "Expenditure and income of households", 
       x = "Weekly income in pounds", 
       y = "Weekly expenditure in pounds", 
       caption = "Source: Living Costs and Food Survey 2013")

# quantile-quantile plot
# read in the data
dolab1 <- read_csv("../data/dolab1.csv")
# use qqplot to create the plot
qqplot(dolab1 %>% filter(treat_group==0) %>% pull(b_read_perc), 
       dolab1 %>% filter(treat_group==1) %>% pull(b_read_perc) )
abline(0,1)



